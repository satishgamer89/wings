<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
<title>Modern Easy Billing — Clean Layout</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- Firebase v9 COMPAT (unchanged) -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>

<!-- PDF lib (unchanged) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<style>
/* ---------------- THEME & BASE ---------------- */
:root{
  --bg: #f4f7fb;
  --panel: #ffffff;
  --muted: #6b7280;
  --text: #0f172a;
  --accent: #3b82f6;
  --accent2: #7c3aed;
  --danger: #ef4444;
  --radius: 12px;
  --shadow: 0 8px 30px rgba(16,24,40,0.06);
  --gap: 16px;
  --transition: 200ms ease;
  --sidebar-width: 260px;
}

@media (prefers-color-scheme: dark) {
  :root{
    --bg: #061226;
    --panel: rgba(12,18,26,0.6);
    --muted: #9aa4b2;
    --text: #e6eef8;
    --shadow: 0 8px 30px rgba(0,0,0,0.6);
  }
}

*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;}
body{padding:14px;}

/* container */
.wrap{max-width:1200px;margin:0 auto;padding-bottom:40px;}

/* topbar */
.topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;}
.brand{display:flex;align-items:center;gap:12px;}
.logoBox{width:44px;height:44px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;}
.titleWrap{line-height:1;}
.title{font-weight:800;font-size:18px;}
.subtitle{font-size:13px;color:var(--muted);}

/* ---------- LAYOUT ---------- */
/* Use a stable column layout */
.app-shell{ display:grid; grid-template-columns: var(--sidebar-width) 1fr; gap:18px; align-items:start; min-height:60vh; }
@media (max-width:980px){
  .app-shell{ grid-template-columns:1fr; }
}

/* ---------- SIDEBAR ---------- */
.sidebar{ background:var(--panel); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow); }
@media (prefers-color-scheme: dark){ .sidebar{ background:var(--panel); } }

.nav{display:flex;flex-direction:column;gap:8px;margin-top:12px;}
.nav-item{padding:10px;border-radius:10px;cursor:pointer;color:var(--muted);font-weight:700;}
.nav-item.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;}

/* quick stats */
.side-stats{margin-top:12px;display:flex;flex-direction:column;gap:8px;}
.stat{background:rgba(0,0,0,0.03);padding:10px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;}
@media (prefers-color-scheme: dark){ .stat{ background: rgba(255,255,255,0.03); } }

/* ---------- MAIN ---------- */
.main{display:flex;flex-direction:column;gap:16px;}

/* cards */
.card{background:var(--panel);border-radius:12px;padding:16px;box-shadow:var(--shadow);}
/* remove initial opacity animation that caused layout jumping */
.card { transition: transform var(--transition), box-shadow var(--transition); }
.card h3{margin:0 0 10px;font-size:16px;}

/* ---------- CREATE GRID ---------- */
.create-grid{ display:grid; grid-template-columns: 1fr 360px; gap:16px; align-items:start; }
/* make sure the right column doesn't overlap the left on small screens */
@media (max-width:980px){
  .create-grid{ grid-template-columns:1fr; }
}

/* ensure items container has min height so it won't collapse */
#itemsContainer{ min-height:60px; display:flex; flex-direction:column; gap:8px; }

/* form controls */
input,textarea,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.08);background:transparent;color:var(--text);font-size:15px;}
input:focus,textarea:focus,select:focus{outline:none;box-shadow:0 6px 20px rgba(59,130,246,0.08);border-color:var(--accent);}

/* item rows */
.item-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
.item-row input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.08);}
.item-row .qty{width:100px;min-width:80px;}
.item-row .price{width:120px;min-width:90px;}
.item-row .remove{background:transparent;border:none;color:var(--danger);cursor:pointer;padding:8px;font-weight:800;}

/* buttons */
button{cursor:pointer;border:none;border-radius:10px;padding:10px 12px;font-weight:700;transition:all var(--transition);}
button.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;}
button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(99,102,241,0.12);}
button.warn{background:linear-gradient(90deg,#ef4444,#f97316);color:#fff;}

/* summary */
.summary{padding:14px;display:flex;flex-direction:column;gap:8px;}
.badge{padding:6px 10px;border-radius:999px;color:#fff;background:linear-gradient(90deg,var(--accent),var(--accent2));font-weight:800;}

/* table */
.table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px;}
.table th,.table td{padding:10px;border-bottom:1px solid rgba(0,0,0,0.05);text-align:left;}
.table th{color:var(--muted);font-weight:700;font-size:13px;}
@media(max-width:640px){
  .table thead{display:none;}
  .table tbody tr{display:block;margin-bottom:12px;background:var(--panel);padding:10px;border-radius:10px;box-shadow:var(--shadow);}
  .table tbody tr td{display:flex;justify-content:space-between;padding:6px 8px;border-bottom:none;}
}

/* modal */
.modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);padding:16px;z-index:12000;}
.modal{width:100%;max-width:920px;max-height:92vh;overflow:auto;border-radius:12px;padding:16px;background:var(--panel);box-shadow:var(--shadow);}
.modal .header{display:flex;justify-content:space-between;align-items:flex-start;}
#modalContent{margin-top:12px;background:linear-gradient(180deg,#fff,#f8fbff);padding:14px;border-radius:10px;}

/* ensure modal z-index is above everything */
#modalBackdrop{z-index:99999;}

/* helpers */
.small-muted{color:var(--muted);font-size:13px;}
.center{display:flex;align-items:center;gap:8px;}

/* fix overlapping caused by position:sticky on small screens: remove sticky for small */
@media (max-width:760px) {
  .sidebar{ position:relative; top:auto; }
}

/* avoid very large fixed widths on tiny screens */
@media (max-width:420px){
  .create-grid{ gap:12px; }
  .logoBox{width:40px;height:40px;}
}

/* keep focus outlines accessible */
:focus{outline-offset:2px;}

/* ensure elements that JS shows/ hides are visible by default for layout measurement */
#mainApp{min-height:400px;}
</style>
</head>
<body>
<div class="wrap">

  <!-- Topbar -->
  <div class="topbar">
    <div class="brand">
      <div class="logoBox">EB</div>
      <div class="titleWrap">
        <div class="title">Modern Easy Billing</div>
        <div class="subtitle">Create & manage invoices</div>
      </div>
    </div>

    <div>
      <button id="logoutBtn" class="warn" style="display:none;">Logout</button>
    </div>
  </div>

  <div class="app-shell">

    <!-- SIDEBAR -->
    <aside class="sidebar card" aria-label="Sidebar">
      <div style="display:flex;gap:12px;align-items:center;">
        <div class="logoBox" style="width:44px;height:44px;">EB</div>
        <div>
          <div style="font-weight:800;">Modern Easy Billing</div>
          <div class="small-muted">Invoice app</div>
        </div>
      </div>

      <!-- AUTH CARD (IDs preserved) -->
      <div id="authSection" style="margin-top:14px;">
        <div style="display:flex;flex-direction:column;gap:8px;">
          <h3 style="margin:0 0 6px;">Login / Register</h3>
          <input type="email" id="email" placeholder="Email">
          <input type="password" id="password" placeholder="Password">
          <div style="display:flex;gap:8px;">
            <button id="loginBtn" class="primary">Login</button>
            <button id="registerBtn" class="ghost">Register</button>
          </div>
          <div id="authMsg" style="margin-top:10px;color:green;font-weight:700;"></div>
        </div>
      </div>

      <!-- STATS -->
      <div class="side-stats" style="margin-top:14px;">
        <div class="stat"><div class="small-muted">Total invoices</div> <div id="totalCount" class="badge">0</div></div>
        <div class="stat"><div class="small-muted">Last invoice</div> <div id="lastInv" style="font-weight:800;">—</div></div>
      </div>

      <!-- NAV -->
      <div class="nav" style="margin-top:14px;">
        <div id="tabCreateBtn" class="nav-item active">Create Invoice</div>
        <div id="tabRecordsBtn" class="nav-item">Invoice Records</div>
        <div id="tabCompanyBtn" class="nav-item">Company Info</div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">

      <div id="mainApp" style="display:none;">

        <!-- COMPANY -->
        <div id="paneCompany" style="display:none;">
          <div class="card">
            <h3>Company Info</h3>
            <input type="text" id="companyName" placeholder="Company Name">
            <textarea id="companyAddress" placeholder="Address" rows="3"></textarea>
            <input type="text" id="companyPhone" placeholder="Phone">
            <input type="text" id="companyGST" placeholder="GST / Tax">
            <input type="number" id="defaultTax" placeholder="Default Tax %" min="0">
            <div style="display:flex;gap:10px;margin-top:8px;">
              <button id="saveCompanyBtn" class="primary">Save Company Info</button>
              <div id="companyMsg" style="color:green;margin-top:6px;align-self:center;"></div>
            </div>
          </div>
        </div>

        <!-- CREATE -->
        <div id="paneCreate">
          <div class="create-grid">
            <div class="card">
              <h3>Client & Items</h3>

              <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                <input type="text" id="clientName" placeholder="Client Name">
                <input type="email" id="clientEmail" placeholder="Client Email">
                <input type="text" id="clientPhone" placeholder="Client Phone">
                <input type="date" id="dueDate" placeholder="Due date">
              </div>

              <div style="margin-top:12px;">
                <h3 style="font-size:15px;margin-bottom:8px;">Items</h3>
                <div id="itemsContainer"></div>

                <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
                  <button id="addItemBtn" class="ghost">+ Add Item</button>
                  <input type="number" id="taxInput" placeholder="Tax %" style="width:120px;">
                  <select id="currencySelect" style="width:120px;">
                    <option value="₹">INR (₹)</option>
                    <option value="$">USD ($)</option>
                    <option value="€">EUR (€)</option>
                  </select>
                </div>

                <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
                  <button id="generateBtn" class="primary">Generate Invoice</button>
                  <button id="deleteAllBtn" class="warn" style="display:none;">Delete All</button>
                </div>
              </div>
            </div>

            <aside class="summary card">
              <h3 style="margin-top:0;">Summary</h3>
              <div style="display:flex;flex-direction:column;gap:8px;">
                <div style="display:flex;justify-content:space-between;">
                  <div class="small-muted">Total invoices</div>
                  <div id="totalCountCopy" style="font-weight:800;">0</div>
                </div>

                <div style="display:flex;justify-content:space-between;">
                  <div class="small-muted">Last invoice</div>
                  <div id="lastInvCopy" style="font-weight:800;">—</div>
                </div>

                <div style="margin-top:10px;">
                  <div class="small-muted">Quick actions</div>
                  <div style="display:flex;gap:8px;margin-top:8px;">
                    <button id="quickViewBtn" class="ghost">View latest</button>
                    <button id="exportAllBtn" class="ghost">Export</button>
                  </div>
                </div>
              </div>
            </aside>
          </div>
        </div>

        <!-- RECORDS -->
        <div id="paneRecords" style="display:none;">
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <h3 style="margin:0;">Invoice Records</h3>
              <input type="text" id="searchInput" placeholder="Search by client or ID" style="max-width:360px;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);">
            </div>

            <table class="table" style="margin-top:12px;">
              <thead>
                <tr><th>ID</th><th>Client</th><th>Date</th><th>Total</th><th>Actions</th></tr>
              </thead>
              <tbody id="recordsBody"></tbody>
            </table>

            <div style="display:flex;justify-content:flex-end;margin-top:12px;">
              <button id="deleteAllBtnFooter" class="warn">Delete All</button>
            </div>
          </div>
        </div>

      </div>

      <!-- logged out notice -->
      <div id="loggedOutNotice" class="card" style="display:none;">
        <h3>Welcome</h3>
        <p class="small-muted">Please log in or register from the left panel to start creating invoices.</p>
      </div>

    </main>
  </div>

  <!-- hidden copies used by JS (safe) -->
  <div style="display:none;"><span id="totalCount-duplicate">0</span></div>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="header">
        <div>
          <h3 id="modalInv" style="margin:0;">Invoice #</h3>
          <div id="modalDate" class="small-muted" style="margin-top:6px;">Date</div>
        </div>
        <div class="actions" style="display:flex;gap:8px;align-items:center;">
          <button id="printBtn" class="primary">Print</button>
          <button id="downloadBtn" class="ghost">Download PDF</button>
          <button id="closeModalBtn" class="warn">Close</button>
        </div>
      </div>

      <div id="modalContent">
        <!-- Filled by JS -->
      </div>
    </div>
  </div>

</div>

<!-- ---------------- ORIGINAL JS (unchanged) ---------------- -->
<script>
// ---------------- Firebase Setup ----------------
const firebaseConfig = {
  apiKey: "AIzaSyALJEa8u1PdLwmOjbtfWWpBRwdNwAIvKAU",
  authDomain: "billing-database-18013.firebaseapp.com",
  databaseURL: "https://billing-database-18013-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "billing-database-18013",
  storageBucket: "billing-database-18013.appspot.com",
  messagingSenderId: "108079794708",
  appId: "1:108079794708:web:3cc0c8654b1520e835b501",
  measurementId: "G-3K6LS952RP"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();


// ----------------- Auth -----------------
document.getElementById("loginBtn").onclick = async () => {
  try {
    await auth.signInWithEmailAndPassword(
      email.value,
      password.value
    );
    authMsg.textContent = "Login successful";
  } catch (e) { alert(e.message); }
};

document.getElementById("registerBtn").onclick = async () => {
  try {
    await auth.createUserWithEmailAndPassword(
      email.value,
      password.value
    );
    authMsg.textContent = "Registration successful";
  } catch (e) { alert(e.message); }
};

document.getElementById("logoutBtn").onclick = () => auth.signOut();

auth.onAuthStateChanged(user => {
  if (user) {
    authSection.style.display = "none";
    mainApp.style.display = "block";
    logoutBtn.style.display = "inline-block";
    loggedOutNotice.style.display = "none";
    loadCompanyInfo();
    loadInvoices();
  } else {
    authSection.style.display = "block";
    mainApp.style.display = "none";
    logoutBtn.style.display = "none";
    loggedOutNotice.style.display = "block";
  }
});


// ----------------- Tabs -----------------
tabCreateBtn.onclick = () => showPane("create");
tabRecordsBtn.onclick = () => showPane("records");
tabCompanyBtn.onclick = () => showPane("company");

function showPane(x){
  paneCreate.style.display = paneRecords.style.display = paneCompany.style.display = "none";
  tabCreateBtn.classList.remove("active");
  tabRecordsBtn.classList.remove("active");
  tabCompanyBtn.classList.remove("active");

  if(x==="create"){ paneCreate.style.display="block"; tabCreateBtn.classList.add("active"); }
  if(x==="records"){ paneRecords.style.display="block"; tabRecordsBtn.classList.add("active"); }
  if(x==="company"){ paneCompany.style.display="block"; tabCompanyBtn.classList.add("active"); }
}


// ----------------- Company Save -----------------
saveCompanyBtn.onclick = async () => {
  const uid = auth.currentUser.uid;
  await db.collection("companies").doc(uid).set({
    name: companyName.value,
    address: companyAddress.value,
    phone: companyPhone.value,
    gst: companyGST.value,
    defaultTax: parseFloat(defaultTax.value)
  });
  companyMsg.textContent = "Saved!";
  setTimeout(() => companyMsg.textContent="",1500);
};

async function loadCompanyInfo(){
  const uid = auth.currentUser.uid;
  const doc = await db.collection("companies").doc(uid).get();
  if(doc.exists){
    const c = doc.data();
    companyName.value = c.name || "";
    companyAddress.value = c.address || "";
    companyPhone.value = c.phone || "";
    companyGST.value = c.gst || "";
    defaultTax.value = c.defaultTax || 10;
    taxInput.value = c.defaultTax || 10;
  }
}


// ----------------- Invoice -----------------
addItem();
addItemBtn.onclick = () => addItem();

function addItem(desc="", qty=1, price=0){
  const row=document.createElement("div");
  row.className="item-row";
  row.innerHTML=`
    <input class="desc" placeholder="Description" value="${desc}">
    <input class="qty" type="number" min="1" value="${qty}">
    <input class="price" type="number" min="0" step="0.01" value="${price}">
    <button class="remove">✕</button>
  `;
  row.querySelector(".remove").onclick=()=>row.remove();
  itemsContainer.appendChild(row);
}


// Auto invoice number
async function getNextInvoiceNumber(uid){
  const ref=db.collection("counters").doc(uid);
  let next=1;

  await db.runTransaction(async t => {
    const doc = await t.get(ref);
    if(doc.exists) next = doc.data().next + 1;
    t.set(ref,{ next: next },{ merge:true });
  });

  return "INV-"+String(next).padStart(5,"0");
}


// Generate invoice
generateBtn.onclick = async () => {
  if(!clientName.value){ alert("Enter client name"); return; }

  const rows=[...document.querySelectorAll(".item-row")];
  const items=[]; let subtotal=0;

  rows.forEach(r=>{
    const d=r.querySelector(".desc").value;
    const q=parseFloat(r.querySelector(".qty").value);
    const p=parseFloat(r.querySelector(".price").value);
    if(d && q>0){
      items.push({desc:d,qty:q,price:p,total:q*p});
      subtotal+=q*p;
    }
  });

  if(items.length===0){ alert("Add at least one item"); return; }

  const uid = auth.currentUser.uid;
  const tax = parseFloat(taxInput.value||0);
  const invoiceId = await getNextInvoiceNumber(uid);

  const invoice={
    id: invoiceId,
    userId: uid,
    client: clientName.value,
    clientEmail: clientEmail.value,
    clientPhone: clientPhone.value,
    items,
    subtotal,
    taxPct: tax,
    total: subtotal*(1+tax/100),
    currency: currencySelect.value,
    date: new Date().toISOString().split("T")[0],
    dueDate: dueDate.value
  };

  await db.collection("invoices").doc(invoiceId).set(invoice);

  clientName.value=clientEmail.value=clientPhone.value="";
  dueDate.value="";
  itemsContainer.innerHTML="";
  addItem();
};


// ----------------- Load invoices -----------------
function loadInvoices(){
  const uid = auth.currentUser.uid;
  const q=db.collection("invoices").where("userId","==",uid).orderBy("date","desc");

  q.onSnapshot(snap=>{
    recordsBody.innerHTML="";
    totalCount.textContent = snap.size;
    lastInv.textContent = snap.size ? snap.docs[0].data().id : "—";

    // Also update copies in UI
    const totalCountCopies = document.querySelectorAll('#totalCountCopy, #totalCount-duplicate');
    totalCountCopies.forEach(el=>{ if(el) el.textContent = snap.size; });
    const lastCopies = document.querySelectorAll('#lastInvCopy');
    lastCopies.forEach(el=>{ if(el) el.textContent = snap.size ? snap.docs[0].data().id : "—"; });

    snap.docs.forEach(doc=>{
      const inv=doc.data();
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${inv.id}</td>
        <td>${inv.client}</td>
        <td>${inv.date}</td>
        <td>${inv.currency} ${inv.total.toFixed(2)}</td>
        <td>
          <button class="viewBtn" data-id="${inv.id}">View</button>
          <button class="delBtn" data-id="${inv.id}">Delete</button>
        </td>
      `;
      recordsBody.appendChild(tr);
    });

    [...document.querySelectorAll(".viewBtn")].forEach(btn=>{
      btn.onclick=()=>openModal(btn.dataset.id);
    });

    [...document.querySelectorAll(".delBtn")].forEach(btn=>{
      btn.onclick=async()=>{
        if(confirm("Delete invoice "+btn.dataset.id+"?")){
          await db.collection("invoices").doc(btn.dataset.id).delete();
        }
      };
    });

  });
}


// ----------------- Modal -----------------
function openModal(id){
  db.collection("invoices").doc(id).get().then(doc=>{
    if(!doc.exists) return;
    const inv=doc.data();

    modalInv.textContent = inv.id;
    modalDate.textContent = inv.date;

    let html=`
      <h4>Client: ${inv.client}</h4>
      Email: ${inv.clientEmail}<br>
      Phone: ${inv.clientPhone}
      <br><br>
      <table style="width:100%;border-collapse:collapse;">
        <tr><th>Description</th><th>Qty</th><th>Price</th><th>Total</th></tr>
    `;

    inv.items.forEach(it=>{
      html+=`<tr>
        <td>${it.desc}</td>
        <td>${it.qty}</td>
        <td>${inv.currency} ${it.price.toFixed(2)}</td>
        <td>${inv.currency} ${it.total.toFixed(2)}</td>
      </tr>`;
    });

    html+=`</table>
      <br>
      Subtotal: ${inv.currency} ${inv.subtotal.toFixed(2)}<br>
      Tax: ${inv.taxPct}%<br>
      <b>Total: ${inv.currency} ${inv.total.toFixed(2)}</b>
    `;

    modalContent.innerHTML=html;
    modalBackdrop.style.display="flex";
  });
}

closeModalBtn.onclick=()=>modalBackdrop.style.display="none";

printBtn.onclick=()=>{
  const w = window.open("");
  w.document.write(modalContent.innerHTML);
  w.print();
  w.close();
};

downloadBtn.onclick=()=>{
  html2pdf().from(modalContent).save(modalInv.textContent+".pdf");
};


// ----------------- Delete All -----------------
deleteAllBtn.onclick=async()=>{
  if(confirm("Delete ALL invoices?")){
    const snap = await db.collection("invoices")
      .where("userId","==",auth.currentUser.uid).get();

    snap.forEach(d=>d.ref.delete());
  }
};

// Also wire footer delete button (exists with different id)
deleteAllBtnFooter.onclick = async () => {
  if(confirm("Delete ALL invoices?")){
    const snap = await db.collection("invoices")
      .where("userId","==",auth.currentUser.uid).get();

    snap.forEach(d=>d.ref.delete());
  }
};


// ----------------- Search -----------------
searchInput.oninput = () => {
  const f = searchInput.value.toLowerCase();
  [...recordsBody.querySelectorAll("tr")].forEach(tr=>{
    tr.style.display =
      tr.cells[0].textContent.toLowerCase().includes(f) ||
      tr.cells[1].textContent.toLowerCase().includes(f)
      ? "" : "none";
  });
};

// Quick view button - open last invoice if exists
quickViewBtn.onclick = () => {
  const id = lastInv.textContent;
  if(id && id !== "—") openModal(id);
};

// Export all: simple JSON download
exportAllBtn.onclick = async () => {
  const uid = auth.currentUser.uid;
  if(!uid) { alert("Login first"); return; }
  const snap = await db.collection("invoices").where("userId","==",uid).get();
  const arr = snap.docs.map(d => d.data());
  const blob = new Blob([JSON.stringify(arr, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "invoices.json";
  a.click();
  URL.revokeObjectURL(url);
};

</script>

</body>
</html>
